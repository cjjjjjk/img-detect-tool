(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{1642:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_c7f111",variable:"__variable_c7f111"}},6760:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(7944)}])},7798:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_acdfbd",variable:"__variable_acdfbd"}},7944:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var n=a(7876),l=a(4232),r=a(7798),s=a.n(r),c=a(1642),i=a.n(c);function d(e){let{onFileSelect:t}=e,[a,r]=(0,l.useState)([]),[s,c]=(0,l.useState)(1),[i,d]=(0,l.useState)(!1),[o,u]=(0,l.useState)(0),h=async e=>{if(!e)return;d(!0),u(0);let t=0,a=Array.from(e).filter(e=>e.type.startsWith("image/")),n=setInterval(()=>{t<80&&u(t+=2)},100);try{await new Promise(e=>setTimeout(e,2e3)),clearInterval(n),u(100),setTimeout(()=>{d(!1),r(e=>[...e,...a]),c(1)},500)}catch(e){clearInterval(n),d(!1)}},x=Math.ceil(a.length/50),m=(s-1)*50,p=(0,l.useMemo)(()=>a.slice(m,m+50),[a,s]),b=e=>{c(e)};return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"border border-dashed border-gray-400 px-3 py-2 rounded-xl",onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),h(e.dataTransfer.files)},onClick:()=>{var e;return null==(e=document.getElementById("fileInput"))?void 0:e.click()},children:[(0,n.jsx)("input",{id:"fileInput",type:"file",accept:"image/*",multiple:!0,webkitdirectory:"true",className:"hidden",onChange:e=>h(e.target.files)}),(0,n.jsx)("p",{className:"text-gray-600",children:"select images"})]}),i?(0,n.jsxs)("div",{className:"mt-4 p-4 text-center",children:[(0,n.jsx)("p",{className:"text-gray-600 mb-2",children:"uploading..."}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,n.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-in-out",style:{width:"".concat(o,"%")}})}),(0,n.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:[o,"%"]})]}):a.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mt-4 flex flex-col gap-2 max-h-[70vh] overflow-y-auto px-3",children:p.map((e,l)=>(0,n.jsxs)("div",{className:"flex items-center justify-between cursor-pointer hover:bg-white/40",onClick:()=>{t(e)},children:[(0,n.jsx)("div",{className:"flex items-center gap-2 flex-1 overflow-hidden",children:(0,n.jsx)("span",{className:"text-sm truncate",children:e.name})}),(0,n.jsx)("span",{className:"text-xs shrink-0 bg-orange-400 text-white rounded-sm px-1 font-bold",children:(e=>{let t=e.split(".");return t.length>1?".".concat(t.pop()):""})(e.name)}),(0,n.jsx)("button",{className:"ml-2 px-2 py-1 text-black text-xs rounded hover:text-red-500 hover:cursor-pointer",onClick:e=>{var t;e.stopPropagation(),t=m+l,r(e=>e.filter((e,a)=>a!==t)),s>Math.ceil((a.length-1)/50)&&c(Math.max(1,s-1))},children:"X"})]},m+l))}),x>1&&(0,n.jsxs)("div",{className:"mt-4 flex justify-center items-center",children:[(0,n.jsx)("button",{onClick:()=>b(s-1),disabled:1===s,className:"px-2 py-1 mx-1 rounded bg-gray-200 disabled:opacity-50",children:"◀"}),(()=>{let e=[],t=Math.max(1,s-Math.floor(2.5)),a=Math.min(x,t+5-1);a-t+1<5&&(t=Math.max(1,a-5+1));for(let l=t;l<=a;l++)e.push((0,n.jsx)("button",{onClick:()=>b(l),className:"h-8 w-8 rounded-full mx-1 ".concat(s===l?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:l},l));return e})(),(0,n.jsx)("button",{onClick:()=>b(s+1),disabled:s===x,className:"px-2 py-1 mx-1 rounded bg-gray-200 disabled:opacity-50",children:"▶"})]})]}):null]})}function o(e){let{imgData:t}=e,[a,r]=(0,l.useState)([]),[s,c]=(0,l.useState)(!1),[i,d]=(0,l.useState)(null);(0,l.useEffect)(()=>{t&&r(e=>{let a=e.findIndex(e=>e.name===t.name);if(-1===a)return[...e,t];{let n=[...e];return n[a]=t,n}})},[t]);let o=e=>{d(e),c(!0)};return(0,n.jsxs)("div",{className:"p-4 border rounded mt-4",children:[(0,n.jsx)("h2",{className:"font-semibold mb-2",children:"Output Data"}),(0,n.jsxs)("table",{className:"w-full border text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-gray-100",children:[(0,n.jsx)("th",{className:"border px-2",children:"Name"}),(0,n.jsx)("th",{className:"border px-2",children:"X"}),(0,n.jsx)("th",{className:"border px-2",children:"Y"}),(0,n.jsx)("th",{className:"border px-2",children:"W"}),(0,n.jsx)("th",{className:"border px-2",children:"H"}),(0,n.jsx)("th",{className:"border px-2 py-1"})]})}),(0,n.jsx)("tbody",{children:a.map((e,t)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"border px-2",children:e.name}),(0,n.jsx)("td",{className:"border px-2",children:e.x}),(0,n.jsx)("td",{className:"border px-2",children:e.y}),(0,n.jsx)("td",{className:"border px-2",children:e.w}),(0,n.jsx)("td",{className:"border px-2",children:e.h}),(0,n.jsx)("td",{className:"border px-2 py-1 text-center",children:(0,n.jsx)("button",{className:"bg-red-500 text-white px-2 py-1 rounded",onClick:()=>{r(e=>e.filter((e,a)=>a!==t))},children:"Del"})})]},t))})]}),(0,n.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>o("csv"),className:"px-3 py-1 bg-blue-600 text-white rounded",children:"Export CSV"}),(0,n.jsx)("button",{onClick:()=>o("txt"),className:"px-3 py-1 bg-green-600 text-white rounded",children:"Export TXT"})]}),s&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-white p-4 rounded w-[400px]",children:[(0,n.jsxs)("h3",{className:"font-semibold mb-2",children:["Preview (",null==i?void 0:i.toUpperCase(),")"]}),(0,n.jsx)("pre",{className:"bg-gray-100 p-2 rounded h-[200px] overflow-auto text-xs",children:"csv"===i?"name,x,y,w,h\n"+a.map(e=>"".concat(e.name,",").concat(e.x,",").concat(e.y,",").concat(e.w,",").concat(e.h)).join("\n"):a.map(e=>"name=".concat(e.name," x=").concat(e.x," y=").concat(e.y," w=").concat(e.w," h=").concat(e.h)).join("\n")}),(0,n.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,n.jsx)("button",{onClick:()=>c(!1),className:"px-3 py-1 bg-gray-400 text-white rounded",children:"Cancel"}),(0,n.jsx)("button",{onClick:()=>{if(!i)return;let e="";"csv"===i?e="name,x,y,w,h\n"+a.map(e=>"".concat(e.name,",").concat(e.x,",").concat(e.y,",").concat(e.w,",").concat(e.h)).join("\n"):"txt"===i&&(e=a.map(e=>"name=".concat(e.name," x=").concat(e.x," y=").concat(e.y," w=").concat(e.w," h=").concat(e.h)).join("\n"));let t=new Blob([e],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(t),l=document.createElement("a");l.href=n,l.download="export_".concat(Math.floor(100*Math.random()),".").concat(i),l.click(),URL.revokeObjectURL(n),c(!1)},className:"px-3 py-1 bg-blue-600 text-white rounded",children:"Download"})]})]})})]})}function u(e){let{file:t,onDataOutput:a}=e,r=(0,l.useRef)(null),s=(0,l.useRef)(null),c=(0,l.useRef)(null),[i,d]=(0,l.useState)(null),[o,u]=(0,l.useState)(null),[h,x]=(0,l.useState)({naturalW:1,naturalH:1,displayW:1,displayH:1}),m=t?URL.createObjectURL(t):null;return(0,l.useEffect)(()=>{u(null)},[t]),(0,l.useEffect)(()=>{if(!o)return;let e=h.displayW/h.naturalW,t=h.displayH/h.naturalH;u({...o,x:Math.round(o.realX*e),y:Math.round(o.realY*t),w:Math.round(o.realW*e),h:Math.round(o.realH*t)})},[h]),(0,n.jsx)("div",{ref:r,className:"tool-container relative border border-dashed p-4 rounded h-[90%] bg-gray-100/80",onMouseDown:e=>{if(!t||!s.current)return;let a=s.current.getBoundingClientRect(),n=e.clientX-a.left,l=e.clientY-a.top;n<0&&(n=0),l<0&&(l=0),n>a.width&&(n=a.width),l>a.height&&(l=a.height),d({x:n,y:l}),u({x:n,y:l,w:0,h:0,realX:0,realY:0,realW:0,realH:0})},onMouseMove:e=>{if(!i||!t)return;let{x:a,y:n}=((e,t)=>{if(!s.current)return{x:0,y:0};let a=s.current.getBoundingClientRect();return{x:Math.max(0,Math.min(a.width,e-a.left)),y:Math.max(0,Math.min(a.height,t-a.top))}})(e.clientX,e.clientY),l=Math.abs(a-i.x),r=Math.abs(n-i.y),c=Math.min(i.x,a),d=Math.min(i.y,n),o=h.naturalW/h.displayW,x=h.naturalH/h.displayH;u({x:c,y:d,w:l,h:r,realX:Math.round(c*o),realY:Math.round(d*x),realW:Math.round(l*o),realH:Math.round(r*x)})},onMouseUp:()=>{if(o&&t){let e=Math.min(o.realX,o.realX+o.realW),n=Math.min(o.realY,o.realY+o.realH),l=Math.abs(o.realW),r=Math.abs(o.realH);console.log({name:t.name,x:e,y:n,w:l,h:r}),a({name:t.name,x:e,y:n,w:l,h:r}),u({...o,realX:e,realY:n,realW:l,realH:r,x:Math.min(o.x,o.x+o.w),y:Math.min(o.y,o.y+o.h),w:Math.abs(o.w),h:Math.abs(o.h)})}d(null)},children:t?(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"mt-2 text-sm text-center truncate flex",children:[t.name,(0,n.jsx)("span",{className:"absolute top-0 left-0 bg-amber-300 text-black text-[10px] px-1",children:"h:".concat(h.naturalH," w:").concat(h.naturalW)})]}),(0,n.jsxs)("div",{ref:s,className:"relative border w-fit min-w-[80vh] border-gray-300",children:[(0,n.jsx)("img",{ref:c,src:m||"",alt:t.name,onLoad:()=>{if(c.current){let e={naturalW:c.current.naturalWidth,naturalH:c.current.naturalHeight,displayW:c.current.clientWidth,displayH:c.current.clientHeight};x(t=>t.naturalW===e.naturalW&&t.naturalH===e.naturalH&&t.displayW===e.displayW&&t.displayH===e.displayH?t:e)}},className:"w-full min-h-[100%] max-h-[100%] object-contain rounded pointer-events-none"}),o&&(0,n.jsx)("div",{className:"absolute border-2 border-red-500 bg-red-500/20",style:{left:o.x,top:o.y,width:o.w,height:o.h},children:(0,n.jsxs)("span",{className:"absolute top-0 left-0 bg-red-600 text-white text-[10px] px-1",children:["x:",o.realX,", y:",o.realY,", w:",o.realW,", h:",o.realH]})})]})]}):(0,n.jsx)("div",{className:"p-4 border w-[100%] text-gray-500",children:"no img select"})})}function h(){let[e,t]=(0,l.useState)(250),[a,r]=(0,l.useState)(400),[c,h]=(0,l.useState)(!1),x=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=e=>{if(c&&x.current){let t=x.current.getBoundingClientRect().right-e.clientX;t>150&&t<600&&r(t)}},t=()=>h(!1);return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),window.addEventListener("mouseleave",t),window.addEventListener("blur",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t),window.removeEventListener("mouseleave",t),window.removeEventListener("blur",t)}},[c]);let[m,p]=(0,l.useState)(null),[b,f]=(0,l.useState)(null);return(0,l.useEffect)(()=>{console.log(b)},[b]),(0,n.jsxs)("div",{ref:x,className:"".concat(s().className," ").concat(i().className," font-sans flex h-screen"),children:[(0,n.jsxs)("div",{style:{width:e},className:"bg-gray-300 transition-all duration-300",children:[(0,n.jsx)("button",{onClick:()=>t(50===e?300:50),className:"p-2 bg-gray-500 text-white",children:50===e?">>":"<<"}),e>0&&(0,n.jsx)("div",{className:"p-2",children:(0,n.jsx)(d,{onFileSelect:p})})]}),(0,n.jsxs)("div",{className:"flex-1 bg-white p-1",children:[(0,n.jsx)(u,{file:m,onDataOutput:f}),(0,n.jsx)("div",{children:"next: space"})]}),(0,n.jsxs)("div",{style:{width:a},className:"relative bg-gray-300",children:[(0,n.jsx)("div",{className:"p-2",children:(0,n.jsx)(o,{imgData:b})}),(0,n.jsx)("div",{onMouseDown:()=>h(!0),className:"absolute left-0 top-0 h-full w-1 cursor-col-resize bg-transparent hover:bg-gray-400"})]})]})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=6760)),_N_E=e.O()}]);