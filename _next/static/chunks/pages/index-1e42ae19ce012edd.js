(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{1642:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_c7f111",variable:"__variable_c7f111"}},6760:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(7944)}])},7798:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_9ecf55",variable:"__variable_9ecf55"}},7944:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var r=a(7876),l=a(4232),n=a(7798),s=a.n(n),o=a(1642),i=a.n(o);let d=(0,l.forwardRef)((e,t)=>{let{onFileSelect:a,isWidthCollapsed:n}=e,[s,o]=(0,l.useState)(!1),[i,d]=(0,l.useState)(0),[c,u]=(0,l.useState)(n),[x,m]=(0,l.useState)([]),[h,b]=(0,l.useState)(1),[p,y]=(0,l.useState)(null),g=Math.ceil(x.length/50),f=(h-1)*50,v=(0,l.useMemo)(()=>x.slice(f,f+50),[x,h]),w=e=>{let t=(e-1)*50;b(e),y(t),a(x[t])};(0,l.useImperativeHandle)(t,()=>({nextImage(){if(null!=p)if(p===f+50-1){if(h<g){let e=h+1,t=(e-1)*50;b(e),j(x[t],t)}}else j(v[p-f+1],p+1)},prevImage(){if(null!=p)if(p===f){if(h>1){let e=h-1,t=Math.min((e-1)*50+50-1,x.length-1);b(e),j(x[t],t)}}else j(v[p-f-1],p-1)}})),(0,l.useEffect)(()=>{x.length&&u(n)},[n]);let N=async e=>{if(!e)return;o(!0),d(0);let t=0,a=Array.from(e).filter(e=>e.type.startsWith("image/")),r=setInterval(()=>{t<80&&d(t+=2)},100);try{await new Promise(e=>setTimeout(e,2e3)),clearInterval(r),d(100),setTimeout(()=>{o(!1),m(e=>[...e,...a]),b(1)},500)}catch(e){clearInterval(r),o(!1)}finally{j(a[0],0)}},j=(e,t)=>{null!=t&&y(t),a(e)};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"border-2 border-dashed border-gray-400 px-3 py-4 rounded-xl text-center cursor-pointer hover:border-blue-500 hover:bg-gray-100/30 transition-colors",onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),N(e.dataTransfer.files)},onClick:()=>{var e;return null==(e=document.getElementById("fileInput"))?void 0:e.click()},children:[(0,r.jsx)("input",{id:"fileInput",type:"file",accept:"image/*",multiple:!0,webkitdirectory:"true",className:"hidden",onChange:e=>N(e.target.files)}),(0,r.jsx)("p",{className:"text-gray-700 font-medium",children:"Select Image Folder"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"or drag and drop"})]}),s?(0,r.jsxs)("div",{className:"mt-4 p-4 text-center",children:[(0,r.jsx)("p",{className:"text-gray-600 mb-2",children:"Uploading..."}),(0,r.jsx)("div",{className:"w-full bg-gray-300 rounded-full h-2.5",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-in-out",style:{width:"".concat(i,"%")}})}),(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:[i,"%"]})]}):x.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mt-4 flex flex-col gap-1 max-h-[70vh] overflow-y-auto px-1",children:v.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between cursor-pointer rounded p-1.5 ".concat(f+t==p?"bg-blue-100 border border-blue-300 text-blue-800":"text-gray-700 hover:bg-gray-100"),onClick:()=>j(e,f+t),children:[(0,r.jsx)("div",{className:"flex items-center gap-2 flex-1 overflow-hidden",children:(0,r.jsx)("span",{className:"text-sm truncate font-medium",children:e.name})}),!c&&(0,r.jsx)("span",{className:"text-xs shrink-0 bg-gray-500 text-white rounded-sm px-1 font-bold",children:(e=>{let t=e.split(".");return t.length>1?".".concat(t.pop()):""})(e.name)}),!c&&(0,r.jsx)("button",{className:"ml-2 px-2 py-1 text-gray-400 text-xs rounded hover:text-red-600 hover:cursor-pointer font-bold",onClick:e=>{var a;e.stopPropagation(),a=f+t,m(e=>e.filter((e,t)=>t!==a)),h>Math.ceil((x.length-1)/50)&&b(Math.max(1,h-1))},children:"X"})]},f+t))}),g>1&&(0,r.jsxs)("div",{className:"mt-4 flex justify-center items-center",children:[(0,r.jsx)("button",{onClick:()=>w(h-1),disabled:1===h,className:"px-2 py-1 mx-1 rounded bg-gray-300 disabled:opacity-50",children:"◀"}),(()=>{let e=[],t=Math.max(1,h-Math.floor(2.5)),a=Math.min(g,t+5-1);a-t+1<5&&(t=Math.max(1,a-5+1));for(let l=t;l<=a;l++)e.push((0,r.jsx)("button",{onClick:()=>w(l),className:"h-8 w-8 rounded-full mx-1 text-xs font-semibold ".concat(h===l?"bg-blue-600 text-white":"bg-gray-300 text-gray-800 hover:bg-gray-400/50"),children:l},l));return e})(),(0,r.jsx)("button",{onClick:()=>w(h+1),disabled:h===g,className:"px-2 py-1 mx-1 rounded bg-gray-300 disabled:opacity-50",children:"▶"})]})]}):null]})});function c(e){let{annotations:t,onAnnotationsChange:a,imageName:l,imageSize:n}=e;return(0,r.jsxs)("div",{className:"p-4 border rounded mt-4 overflow-hidden min-h-[30vh] flex flex-col bg-white/50",children:[(0,r.jsx)("h2",{className:"font-semibold mb-2 text-gray-800",children:"Output Data (Current Image)"}),(0,r.jsxs)("p",{className:"text-sm mb-2 truncate text-black",children:["File: ",(0,r.jsx)("strong",{className:"text-black",children:l||"N/A"})]}),(0,r.jsx)("div",{className:"flex-grow overflow-y-auto border border-gray-300 rounded",children:(0,r.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,r.jsx)("thead",{className:"sticky top-0",children:(0,r.jsxs)("tr",{className:"bg-gray-200 text-gray-700",children:[(0,r.jsx)("th",{className:"border-b border-gray-500 px-3 py-2 text-left",children:"Class"}),(0,r.jsx)("th",{className:"border-b border-gray-500 px-3 py-2 text-left",children:"Box (x,y,w,h)"}),(0,r.jsx)("th",{className:"border-b border-gray-500 px-3 py-2 text-left",children:"Keypoint (x,y)"}),(0,r.jsx)("th",{className:"border-b border-gray-500 px-3 py-2 text-center",children:"Action"})]})}),(0,r.jsxs)("tbody",{children:[t.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-100/50",children:[(0,r.jsxs)("td",{className:"border-b border-gray-400 px-3 text-black py-1.5",children:[e.className," (",e.classId,")"]}),(0,r.jsx)("td",{className:"border-b border-gray-400 px-3 text-black py-1.5 font-mono text-xs",children:"(".concat(e.box.x,", ").concat(e.box.y,") [").concat(e.box.w,"x").concat(e.box.h,"]")}),(0,r.jsx)("td",{className:"border-b border-gray-400 px-3 text-black py-1.5 font-mono text-xs",children:e.keypoint?"(".concat(e.keypoint.x,", ").concat(e.keypoint.y,")"):(0,r.jsx)("span",{className:"text-gray-400",children:"N/A"})}),(0,r.jsx)("td",{className:"border-b border-gray-400 px-3 text-black py-1.5 text-center",children:(0,r.jsx)("button",{className:"bg-red-500 text-white px-2 py-0.5 rounded text-xs font-semibold hover:bg-red-600",onClick:()=>{var r;return r=e.id,void a(t.filter(e=>e.id!==r))},children:"Del"})})]},e.id)),0===t.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:4,className:"text-center p-4 text-gray-500",children:"No annotations yet."})})]})]})}),(0,r.jsx)("div",{className:"mt-4 flex gap-2",children:(0,r.jsxs)("button",{onClick:()=>{if(!l)return void alert("No image selected.");let e=(()=>{let{naturalW:e,naturalH:a}=n;if(e<=1||a<=1)return"";let r=[];for(let l of t){if(!l.keypoint)continue;let{box:t,keypoint:n,classId:s}=l,o=(t.x+t.w/2)/e,i=(t.y+t.h/2)/a,d=t.w/e,c=t.h/a,u=n.x/e,x=n.y/a,m=[s,o.toFixed(6),i.toFixed(6),d.toFixed(6),c.toFixed(6),u.toFixed(6),x.toFixed(6),2].join(" ");r.push(m)}return r.join("\n")})(),a=l.split(".").slice(0,-1).join("."),r=new Blob([e],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(r),o=document.createElement("a");o.href=s,o.download="".concat(a,".txt"),o.click(),URL.revokeObjectURL(s)},className:"px-3 py-2 bg-blue-600 text-white rounded w-full font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!l||0===t.length,children:["Download ",l.split(".").slice(0,-1).join(".")||"labels",".txt"]})})]})}let u=[{id:0,name:"car",color:"border-red-500",bg:"bg-red-500/20"},{id:1,name:"bus",color:"border-blue-500",bg:"bg-blue-500/20"},{id:2,name:"truck",color:"border-green-500",bg:"bg-green-500/20"},{id:3,name:"motorcycle",color:"border-yellow-500",bg:"bg-yellow-500/20"}];function x(e){let{file:t,annotations:a,onAnnotationsChange:n,onImageLoad:s}=e,o=(0,l.useRef)(null),i=(0,l.useRef)(null),d=(0,l.useRef)(null),[c,x]=(0,l.useState)(null),[m,h]=(0,l.useState)(null),[b,p]=(0,l.useState)({naturalW:1,naturalH:1,displayW:1,displayH:1}),[y,g]=(0,l.useState)("draw_box"),[f,v]=(0,l.useState)(u[0]),[w,N]=(0,l.useState)(null),j=t?URL.createObjectURL(t):null,k=(e,t)=>{if(!i.current)return{x:0,y:0};let a=i.current.getBoundingClientRect();return{x:Math.max(0,Math.min(a.width,e-a.left)),y:Math.max(0,Math.min(a.height,t-a.top))}},M=()=>{if(c&&m&&t){if(m.w<5||m.h<5){h(null),x(null);return}let e=Math.min(m.realX,m.realX+m.realW),t=Math.min(m.realY,m.realY+m.realH),r=Math.abs(m.realW),l=Math.abs(m.realH),s={id:crypto.randomUUID(),classId:f.id,className:f.name,box:{x:e,y:t,w:r,h:l},keypoint:null};n([...a,s]),g("add_keypoint"),N(s.id)}h(null),x(null)},W=()=>{if(d.current){let e={naturalW:d.current.naturalWidth,naturalH:d.current.naturalHeight,displayW:d.current.clientWidth,displayH:d.current.clientHeight};p(t=>t.naturalW===e.naturalW&&t.naturalH===e.naturalH&&t.displayW===e.displayW&&t.displayH===e.displayH?t:(s(e),e))}};(0,l.useEffect)(()=>{h(null),x(null),g("draw_box"),N(null),W()},[t]),(0,l.useEffect)(()=>{if(!m||!m.realW)return;let e=b.displayW/b.naturalW,t=b.displayH/b.naturalH;h({...m,x:Math.round(m.realX*e),y:Math.round(m.realY*t),w:Math.round(m.realW*e),h:Math.round(m.realH*t)})},[b]),(0,l.useEffect)(()=>{w&&(a.some(e=>e.id===w)||(g("draw_box"),N(null)))},[a,w]);let _=(0,l.useMemo)(()=>{if(b.naturalW<=1||b.naturalH<=1)return[];let e=b.displayW/b.naturalW,t=b.displayH/b.naturalH;return a.map(a=>({...a,displayBox:{x:Math.round(a.box.x*e),y:Math.round(a.box.y*t),w:Math.round(a.box.w*e),h:Math.round(a.box.h*t)},displayKeypoint:a.keypoint?{x:Math.round(a.keypoint.x*e),y:Math.round(a.keypoint.y*t)}:null}))},[a,b]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex gap-2 p-2 bg-gray-100 rounded items-center",children:[(0,r.jsx)("span",{className:"font-medium text-sm text-gray-700",children:"Select Class:"}),u.map(e=>(0,r.jsx)("button",{onClick:()=>v(e),className:"px-3 py-1 text-xs rounded font-semibold ".concat(f.id===e.id?"bg-blue-600 text-white ring-2 ring-blue-300":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:e.name},e.id))]}),"add_keypoint"===y&&(0,r.jsxs)("div",{className:"p-2 text-center bg-blue-100 text-blue-800 rounded border border-blue-300 font-medium",children:["Right-click INSIDE box ",(0,r.jsxs)("strong",{children:[null==w?void 0:w.substring(0,6),"..."]})," to assign keypoint."]}),(0,r.jsx)("div",{ref:o,className:"tool-container relative border border-dashed p-4 rounded h-[90%] bg-gray-100/80",onMouseDown:e=>{if(!t||!i.current||"draw_box"!==y||0!==e.button)return;let{x:a,y:r}=k(e.clientX,e.clientY);x({x:a,y:r}),h({x:a,y:r,w:0,h:0,realX:0,realY:0,realW:0,realH:0})},onMouseMove:e=>{if(!c||!t||!m)return;let{x:a,y:r}=k(e.clientX,e.clientY),l=Math.abs(a-c.x),n=Math.abs(r-c.y),s=Math.min(c.x,a),o=Math.min(c.y,r),i=b.naturalW/b.displayW,d=b.naturalH/b.displayH;h({...m,x:s,y:o,w:l,h:n,realX:Math.round(s*i),realY:Math.round(o*d),realW:Math.round(l*i),realH:Math.round(n*d)})},onMouseUp:M,onMouseLeave:M,onContextMenu:e=>{if(e.preventDefault(),!t||"add_keypoint"!==y||!w)return;let r=a.find(e=>e.id===w);if(!r)return;let{x:l,y:s}=k(e.clientX,e.clientY),o=b.naturalW/b.displayW,i=b.naturalH/b.displayH,d=Math.round(l*o),c=Math.round(s*i),u=r.box;d>=u.x&&d<=u.x+u.w&&c>=u.y&&c<=u.y+u.h?(n(a.map(e=>e.id===w?{...e,keypoint:{x:d,y:c}}:e)),g("draw_box"),N(null)):alert("Keypoint must be inside the bounding box. Please try again.")},children:t?(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"mt-2 text-sm text-center truncate flex",children:[t.name,(0,r.jsx)("span",{className:"absolute top-1 left-1 bg-black/60 text-white text-xs px-2 py-0.5 rounded-sm",children:"w:".concat(b.naturalW," h:").concat(b.naturalH)})]}),(0,r.jsxs)("div",{ref:i,className:"relative border w-fit min-w-[80vh] border-gray-300 cursor-crosshair",style:{cursor:"add_keypoint"===y?"pointer":"crosshair"},children:[(0,r.jsx)("img",{ref:d,src:j||"",alt:t.name,onLoad:W,className:"w-full min-h-[100%] max-h-[100%] object-contain rounded pointer-events-none"}),_.map(e=>{let t=u.find(t=>t.id===e.classId)||u[0],a=e.id===w;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"absolute border-2 ".concat(t.color," ").concat(t.bg," ").concat(a?"animate-pulse ring-4 ring-blue-400/50":""),style:{left:e.displayBox.x,top:e.displayBox.y,width:e.displayBox.w,height:e.displayBox.h},children:(0,r.jsxs)("span",{className:"absolute -top-5 left-0 ".concat(t.color.replace("border","text")," text-xs px-1 font-bold bg-white/50 backdrop-blur-sm rounded"),children:[e.className," ",a?"(Awaiting keypoint)":""]})}),e.displayKeypoint&&(0,r.jsx)("div",{className:"absolute w-2.5 h-2.5 rounded-full ".concat(t.bg.replace("/20","/80")," ").concat(t.color," border-2"),style:{left:e.displayKeypoint.x-5,top:e.displayKeypoint.y-5}})]},e.id)}),m&&(0,r.jsx)("div",{className:"absolute border-2 ".concat(f.color," ").concat(f.bg),style:{left:m.x,top:m.y,width:m.w,height:m.h},children:(0,r.jsxs)("span",{className:"absolute top-0 left-0 bg-black/70 text-white text-xs px-1",children:["w:",m.realW,", h:",m.realH]})})]})]}):(0,r.jsx)("div",{className:"p-4 border w-[100%] text-gray-500 text-center",children:"No image selected"})})]})}function m(){let[e,t]=(0,l.useState)(250),[a,n]=(0,l.useState)(300),[o,u]=(0,l.useState)(!1),m=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=e=>{if(o&&m.current){let t=m.current.getBoundingClientRect().right-e.clientX;t>250&&t<600&&n(t)}},t=()=>u(!1);return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),window.addEventListener("mouseleave",t),window.addEventListener("blur",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t),window.removeEventListener("mouseleave",t),window.removeEventListener("blur",t)}},[o]);let[h,b]=(0,l.useState)(null),[p,y]=(0,l.useState)({naturalW:1,naturalH:1}),[g,f]=(0,l.useState)(new Map),v=g.get((null==h?void 0:h.name)||"")||[],w=e=>{if(!h)return;let t=new Map(g);t.set(h.name,e),f(t)},N=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=e=>{var t,a;"Space"!==e.code||e.ctrlKey||(e.preventDefault(),null==(t=N.current)||t.nextImage()),"Space"===e.code&&e.ctrlKey&&(e.preventDefault(),null==(a=N.current)||a.prevImage())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,r.jsxs)("div",{ref:m,className:"".concat(s().className," ").concat(i().className," font-sans flex h-screen bg-gray-100"),children:[(0,r.jsxs)("div",{style:{width:e},className:"bg-gray-200 transition-all duration-300 flex flex-col shadow-lg",children:[(0,r.jsx)("button",{onClick:()=>t(100===e?300:100),className:"p-2 bg-gray-600 text-white font-bold hover:bg-gray-700",children:100===e?">>":"<<"}),e>0&&(0,r.jsx)("div",{className:"p-2 flex-1",children:(0,r.jsx)(d,{ref:N,onFileSelect:b,isWidthCollapsed:100===e})})]}),(0,r.jsxs)("div",{className:"flex-1 bg-white p-2 flex flex-col gap-2",children:[(0,r.jsx)(x,{file:h,annotations:v,onAnnotationsChange:w,onImageLoad:e=>{e.naturalW>1&&e.naturalH>1&&y({naturalW:e.naturalW,naturalH:e.naturalH})}}),(0,r.jsxs)("div",{className:"mt-2 p-3 border border-gray-300 rounded bg-gray-50 text-sm text-gray-700 shadow-sm",children:[(0,r.jsx)("h3",{className:"font-semibold mb-2 text-gray-800",children:"Hotkeys & Tips"}),(0,r.jsxs)("div",{className:"flex flex-col items-start gap-2",children:[(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 text-gray-800 rounded font-mono text-xs",children:"Space"}),": Next Image"]}),(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 text-gray-800 rounded font-mono text-xs",children:"Ctrl + Space"}),": Previous Image"]}),(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 text-gray-800 rounded font-mono text-xs",children:"Left-click Drag"}),": Draw Bounding Box"]}),(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 text-gray-800 rounded font-mono text-xs",children:"Right-click"}),": Assign Keypoint (after drawing box)"]})]})]})]}),(0,r.jsxs)("div",{style:{width:a},className:"relative bg-gray-200 shadow-inner",children:[(0,r.jsx)("div",{className:"p-2",children:(0,r.jsx)(c,{imageName:(null==h?void 0:h.name)||"",imageSize:p,annotations:v,onAnnotationsChange:w})}),(0,r.jsx)("div",{onMouseDown:()=>u(!0),className:"absolute left-0 top-0 h-full w-1.5 cursor-col-resize bg-transparent hover:bg-blue-400 transition-colors duration-200"})]})]})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=6760)),_N_E=e.O()}]);