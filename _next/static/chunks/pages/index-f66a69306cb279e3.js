(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{1642:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_c7f111",variable:"__variable_c7f111"}},6760:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(7944)}])},7798:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_9ecf55",variable:"__variable_9ecf55"}},7944:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var r=a(7876),l=a(4232),n=a(7798),s=a.n(n),o=a(1642),i=a.n(o);let d=(0,l.forwardRef)((e,t)=>{let{onFileSelect:a,isWidthCollapsed:n,onFilesChange:s}=e,[o,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)(0),[u,x]=(0,l.useState)(n),[m,p]=(0,l.useState)([]),[h,b]=(0,l.useState)(1),[g,y]=(0,l.useState)(null),f=Math.ceil(m.length/50),w=(h-1)*50,v=(0,l.useMemo)(()=>m.slice(w,w+50),[m,h]),j=e=>{let t=(e-1)*50;b(e),y(t),a(m[t])};(0,l.useImperativeHandle)(t,()=>({nextImage(){if(null!=g)if(g===w+50-1){if(h<f){let e=h+1,t=(e-1)*50;b(e),k(m[t],t)}}else k(v[g-w+1],g+1)},prevImage(){if(null!=g)if(g===w){if(h>1){let e=h-1,t=Math.min((e-1)*50+50-1,m.length-1);b(e),k(m[t],t)}}else k(v[g-w-1],g-1)}})),(0,l.useEffect)(()=>{m.length&&x(n)},[n]);let N=async e=>{if(!e)return;i(!0),c(0);let t=0,a=Array.from(e).filter(e=>e.type.startsWith("image/")),r=setInterval(()=>{t<80&&c(t+=2)},100);try{await new Promise(e=>setTimeout(e,2e3)),clearInterval(r),c(100),setTimeout(()=>{i(!1),p(e=>{let t=[...e,...a];return s(t),t}),b(1)},500)}catch(e){clearInterval(r),i(!1)}finally{k(a[0],0)}},k=(e,t)=>{null!=t&&y(t),a(e)};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"border-2 border-dashed border-gray-400 px-3 py-4 rounded-xl text-center cursor-pointer hover:border-blue-500 hover:bg-gray-100/30 transition-colors",onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),N(e.dataTransfer.files)},onClick:()=>{var e;return null==(e=document.getElementById("fileInput"))?void 0:e.click()},children:[(0,r.jsx)("input",{id:"fileInput",type:"file",accept:"image/*",multiple:!0,webkitdirectory:"true",className:"hidden",onChange:e=>N(e.target.files)}),u?(0,r.jsx)("p",{className:"text-gray-700 font-medium",children:"Select"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-gray-700 font-medium",children:"Select Image Folder"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"or drag and drop"})]})]}),o?(0,r.jsxs)("div",{className:"mt-4 p-4 text-center",children:[(0,r.jsx)("p",{className:"text-gray-600 mb-2",children:"Uploading..."}),(0,r.jsx)("div",{className:"w-full bg-gray-300 rounded-full h-2.5",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-in-out",style:{width:"".concat(d,"%")}})}),(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:[d,"%"]})]}):m.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mt-4 flex flex-col gap-1 max-h-[70vh] overflow-y-auto px-1",children:v.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between cursor-pointer rounded p-1.5 ".concat(w+t==g?"bg-blue-100 border border-blue-300 text-blue-800":"text-gray-700 hover:bg-gray-100"),onClick:()=>k(e,w+t),children:[(0,r.jsx)("div",{className:"flex items-center gap-2 flex-1 overflow-hidden",children:(0,r.jsx)("span",{className:"text-sm truncate font-medium",children:e.name})}),!u&&(0,r.jsx)("span",{className:"text-xs shrink-0 bg-gray-500 text-white rounded-sm px-1 font-bold",children:(e=>{let t=e.split(".");return t.length>1?".".concat(t.pop()):""})(e.name)}),!u&&(0,r.jsx)("button",{className:"ml-2 px-2 py-1 text-gray-400 text-xs rounded hover:text-red-600 hover:cursor-pointer font-bold",onClick:e=>{e.stopPropagation(),(e=>{let t=m.filter((t,a)=>a!==e);p(t),s(t),h>Math.ceil(t.length/50)&&b(Math.max(1,h-1))})(w+t)},children:"X"})]},w+t))}),f>1&&(0,r.jsxs)("div",{className:"mt-4 flex justify-center items-center",children:[(0,r.jsx)("button",{onClick:()=>j(h-1),disabled:1===h,className:"px-2 py-1 mx-1 rounded bg-gray-300 disabled:opacity-50",children:"◀"}),(()=>{let e=[],t=Math.max(1,h-Math.floor(2.5)),a=Math.min(f,t+5-1);a-t+1<5&&(t=Math.max(1,a-5+1));for(let l=t;l<=a;l++)e.push((0,r.jsx)("button",{onClick:()=>j(l),className:"h-8 w-8 rounded-full mx-1 text-xs font-semibold ".concat(h===l?"bg-blue-600 text-white":"bg-gray-300 text-gray-800 hover:bg-gray-400/50"),children:l},l));return e})(),(0,r.jsx)("button",{onClick:()=>j(h+1),disabled:h===f,className:"px-2 py-1 mx-1 rounded bg-gray-300 disabled:opacity-50",children:"▶"})]})]}):null]})});function c(e){let{annotations:t,onAnnotationsChange:a,imageName:n,imageSize:s,classes:o,allImageFiles:i,onBulkAnnotationsUpdate:d,keypointCount:c}=e,[u,x]=(0,l.useState)(!1),m=async e=>{let t=e.target.files;if(!t||0===t.length)return;x(!0);let a=Array.from(t).filter(e=>e.name.endsWith(".txt")),r=new Map,l=e=>new Promise((t,a)=>{let r=new Image,l=URL.createObjectURL(e);r.onload=()=>{t({w:r.naturalWidth,h:r.naturalHeight}),URL.revokeObjectURL(l)},r.onerror=e=>{a(e),URL.revokeObjectURL(l)},r.src=l});for(let e of a)try{let t=e.name.split(".").slice(0,-1).join("."),a=i.find(e=>e.name.split(".").slice(0,-1).join(".")===t);if(!a){console.warn("No matching image found for label: ".concat(e.name));continue}let{w:n,h:s}=await l(a);if(n<=1||s<=1)continue;let d=(await e.text()).split("\n").filter(e=>""!==e.trim()),u=[];for(let e of d){let t=e.split(" ").map(Number),a=5+3*c,r=c>0?a:5;if(t.length<r){console.warn("Skipping line: Expected ".concat(r," parts, got ").concat(t.length));continue}if(c>0&&t.length<a){console.warn("Skipping line: Mismatch keypoint count. Expected ".concat(a," parts, got ").concat(t.length));continue}let[l,i,d,x,m]=t,p=o.find(e=>e.id===l);if(!p)continue;let h=x*n,b=m*s,g=i*n-h/2,y=d*s-b/2,f=[];if(c>0)for(let e=0;e<c;e++){let a=t[5+3*e],r=t[5+3*e+1],l=t[5+3*e+2];0===l?f.push(null):f.push({x:Math.round(a*n),y:Math.round(r*s)})}let w={id:crypto.randomUUID(),classId:p.id,className:p.name,box:{x:Math.round(g),y:Math.round(y),w:Math.round(h),h:Math.round(b)},keypoints:f};u.push(w)}u.length>0&&r.set(a.name,u)}catch(t){console.error("Failed to process label file ".concat(e.name,":"),t)}r.size>0?(d(r),alert("Successfully imported and applied ".concat(r.size," label file(s) (Note: Labels may be ignored if keypoint count doesn't match current settings)."))):alert("No valid label files found or matched."),x(!1),e.target&&(e.target.value="")};return(0,r.jsxs)("div",{className:"p-4 border rounded mt-4 overflow-hidden min-h-[30vh] max-h-[80vh] flex flex-col bg-white/50",children:[(0,r.jsx)("input",{type:"file",id:"labelInput",webkitdirectory:"true",multiple:!0,className:"hidden",onChange:m,accept:".txt"}),(0,r.jsxs)("h2",{className:"font-semibold mb-2 w-full text-gray-800 flex justify-between",children:["Output Data (Current Image)",(0,r.jsx)("button",{onClick:()=>{var e;return null==(e=document.getElementById("labelInput"))?void 0:e.click()},className:"px-3 py-1 bg-green-600 text-white rounded  font-semibold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:u||0===i.length,children:u?"Importing...":"▲ Upload"})]}),(0,r.jsxs)("p",{className:"text-sm mb-2  text-black",children:["File: ",(0,r.jsx)("strong",{className:"text-black",children:n||"N/A"})]}),(0,r.jsx)("div",{className:"flex-grow overflow-y-auto border border-gray-300 rounded",children:(0,r.jsxs)("table",{className:"w-full text-sm border-collapse",children:[(0,r.jsx)("thead",{className:"sticky top-0",children:(0,r.jsxs)("tr",{className:"bg-gray-200 text-gray-700",children:[(0,r.jsx)("th",{className:"border-b border-gray-500 px-3 py-2 text-center",children:"#"}),(0,r.jsx)("th",{className:"border-b border-gray-500 px-3 py-2 text-left",children:"Class"}),(0,r.jsx)("th",{className:"border-b border-gray-500 px-3 py-2 text-left",children:"Box (x,y,w,h)"}),c>0&&(0,r.jsx)("th",{className:"border-b border-gray-500 px-3 py-2 text-left",children:"Keypoints (x,y)"}),(0,r.jsx)("th",{className:"border-b border-gray-500 px-3 py-2 text-center",children:"Action"})]})}),(0,r.jsxs)("tbody",{children:[t.map((e,l)=>(0,r.jsxs)("tr",{className:"hover:bg-gray-100/50",children:[(0,r.jsx)("td",{className:"border-b border-gray-400 px-3 text-black py-1.5 text-center font-mono text-xs",children:l+1}),(0,r.jsxs)("td",{className:"border-b border-gray-400 px-3 text-black py-1.5",children:[e.className," (",e.classId,")"]}),(0,r.jsx)("td",{className:"border-b border-gray-400 px-3 text-black py-1.5 font-mono text-xs",children:"(".concat(e.box.x,", ").concat(e.box.y,") [").concat(e.box.w,"x").concat(e.box.h,"]")}),c>0&&(0,r.jsx)("td",{className:"border-b border-gray-400 px-3 text-black py-1.5 font-mono text-xs",children:e.keypoints.map((e,t)=>(0,r.jsxs)("span",{className:"mr-1 ".concat(e?"":"text-gray-400"),children:["[",t+1,": ",e?"".concat(e.x,",").concat(e.y):"N/A","]"]},t))}),(0,r.jsx)("td",{className:"border-b border-gray-400 px-3 text-black py-1.5 text-center",children:(0,r.jsx)("button",{className:"bg-red-500 text-white px-2 py-0.5 rounded text-xs font-semibold hover:bg-red-600",onClick:()=>{var r;return r=e.id,void a(t.filter(e=>e.id!==r))},children:"Del"})})]},e.id)),0===t.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:c>0?5:4,className:"text-center p-4 text-gray-500",children:"No annotations yet."})})]})]})}),(0,r.jsx)("div",{className:"mt-4 flex flex-col gap-2",children:(0,r.jsxs)("button",{onClick:()=>{if(!n)return void alert("No image selected.");let e=(()=>{let{naturalW:e,naturalH:a}=s;if(e<=1||a<=1)return"";let r=[];for(let l of t){let{box:t,keypoints:n,classId:s}=l,o=(t.x+t.w/2)/e,i=(t.y+t.h/2)/a,d=t.w/e,u=t.h/a,x=[s,o.toFixed(6),i.toFixed(6),d.toFixed(6),u.toFixed(6)];if(c>0){n.length!==c||n.some(e=>null===e);let t=n.flatMap(t=>t?[(t.x/e).toFixed(6),(t.y/a).toFixed(6),2]:["0.000000","0.000000",0]);for(let e=n.length;e<c;e++)t.push("0.000000","0.000000",0);x.push(...t)}r.push(x.join(" "))}return r.join("\n")})(),a=n.split(".").slice(0,-1).join("."),r=new Blob([e],{type:"text/plain;charset=utf-8"}),l=URL.createObjectURL(r),o=document.createElement("a");o.href=l,o.download="".concat(a,".txt"),o.click(),URL.revokeObjectURL(l)},className:"px-3 py-2 bg-blue-600 text-white rounded w-full font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!n||0===t.length,children:["Download ",n.split(".").slice(0,-1).join(".")||"labels",".txt"]})})]})}function u(e){let{file:t,annotations:a,onAnnotationsChange:n,onImageLoad:s,classes:o,onClassesChange:i,keypointCount:d,onKeypointCountChange:c,onModeChange:u}=e,x=(0,l.useRef)(null),m=(0,l.useRef)(null),p=(0,l.useRef)(null),[h,b]=(0,l.useState)(null),[g,y]=(0,l.useState)(null),[f,w]=(0,l.useState)({naturalW:1,naturalH:1,displayW:1,displayH:1}),[v,j]=(0,l.useState)("draw_box"),[N,k]=(0,l.useState)(o[0]),[M,S]=(0,l.useState)(null),[C,_]=(0,l.useState)(0),W=t?URL.createObjectURL(t):null,H=e=>{j(e),u(e)},I=(e,t)=>{if(!m.current)return{x:0,y:0};let a=m.current.getBoundingClientRect();return{x:Math.max(0,Math.min(a.width,e-a.left)),y:Math.max(0,Math.min(a.height,t-a.top))}},E=()=>{if(h&&g&&t&&N){if(g.w<5||g.h<5){y(null),b(null);return}let e=Math.min(g.realX,g.realX+g.realW),t=Math.min(g.realY,g.realY+g.realH),r=Math.abs(g.realW),l=Math.abs(g.realH),s={id:crypto.randomUUID(),classId:N.id,className:N.name,box:{x:e,y:t,w:r,h:l},keypoints:Array(d).fill(null)};n([...a,s]),d>0?(H("add_keypoints"),S(s.id),_(0)):H("draw_box")}y(null),b(null)},L=()=>{if(p.current){let e={naturalW:p.current.naturalWidth,naturalH:p.current.naturalHeight,displayW:p.current.clientWidth,displayH:p.current.clientHeight};w(t=>t.naturalW===e.naturalW&&t.naturalH===e.naturalH&&t.displayW===e.displayW&&t.displayH===e.displayH?t:(s(e),e))}};(0,l.useEffect)(()=>{y(null),b(null),H("draw_box"),S(null),_(0),o.length>0?o.find(e=>e.id===(null==N?void 0:N.id))||k(o[0]):k(null),L()},[t,o]),(0,l.useEffect)(()=>{if(!g||!g.realW)return;let e=f.displayW/f.naturalW,t=f.displayH/f.naturalH;y({...g,x:Math.round(g.realX*e),y:Math.round(g.realY*t),w:Math.round(g.realW*e),h:Math.round(g.realH*t)})},[f]),(0,l.useEffect)(()=>{M&&(a.some(e=>e.id===M)||(H("draw_box"),S(null),_(0)))},[a,M]),(0,l.useEffect)(()=>{let e=e=>{if("add_keypoints"!==v||"Space"!==e.code||e.ctrlKey||!M)return;e.preventDefault();let t=a.find(e=>e.id===M);if(!t)return;let r=[...t.keypoints];r[C]=null,n(a.map(e=>e.id===M?{...e,keypoints:r}:e)),C<d-1?_(C+1):(H("draw_box"),S(null),_(0))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[v,M,C,d,a,n]);let R=(0,l.useMemo)(()=>{if(f.naturalW<=1||f.naturalH<=1)return[];let e=f.displayW/f.naturalW,t=f.displayH/f.naturalH;return a.map(a=>({...a,displayBox:{x:Math.round(a.box.x*e),y:Math.round(a.box.y*t),w:Math.round(a.box.w*e),h:Math.round(a.box.h*t)},displayKeypoints:a.keypoints.map(a=>a?{x:Math.round(a.x*e),y:Math.round(a.y*t)}:null)}))},[a,f]);return(0,l.useEffect)(()=>{o.length>0&&!o.find(e=>e.id===(null==N?void 0:N.id))?k(o[0]):0===o.length&&k(null)},[o,N]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center flex-wrap gap-4 p-2 bg-gray-100 rounded",children:[(0,r.jsxs)("div",{className:"flex gap-2 items-center flex-wrap",children:[(0,r.jsx)("span",{className:"font-medium text-sm text-gray-700",children:"Classes:"}),o.map(e=>(0,r.jsxs)("div",{className:"flex items-center rounded ".concat((null==N?void 0:N.id)===e.id?"ring-2 ring-blue-500":""),onContextMenu:t=>{t.preventDefault();var a=e.id;let r=o.find(e=>e.id===a);r&&confirm('Are you sure you want to delete class "'.concat(r.name,'" (ID: ').concat(r.id,")?"))&&i(o.filter(e=>e.id!==a))},children:[(0,r.jsxs)("button",{onClick:()=>k(e),className:"px-2 py-1 text-xs rounded-l font-semibold ".concat((null==N?void 0:N.id)===e.id?"bg-blue-600 text-white":"bg-gray-200 text-gray-800 hover:bg-gray-300"),children:[e.id," "]}),(0,r.jsx)("input",{type:"text",value:e.name,onChange:t=>{var a,r;return a=e.id,r=t.target.value,void i(o.map(e=>e.id===a?{...e,name:r}:e))},className:"px-2 py-1 text-xs w-20 rounded-r border-l border-gray-400 text-black",placeholder:"Class Name"})]},e.id)),(0,r.jsx)("button",{onClick:()=>{let e=o.reduce((e,t)=>Math.max(e,t.id),-1)+1;i([...o,{id:e,name:"c_".concat(e),color:"border-gray-500",bg:"bg-gray-500/20"}])},className:"px-3 py-1 text-xs rounded font-semibold bg-green-500 text-white hover:bg-green-600",children:"+ Class"})]}),(0,r.jsxs)("div",{className:"flex gap-2 items-center flex-wrap",children:[(0,r.jsx)("span",{className:"font-medium text-sm text-gray-700",children:"Keypoints:"}),(0,r.jsxs)("div",{className:"flex gap-1 items-center",children:[Array.from({length:d}).map((e,t)=>(0,r.jsxs)("span",{className:"px-2 py-0.5 text-xs font-mono bg-gray-300 rounded",children:["[",t+1,"]"]},t)),0===d&&(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"no kpts"})]}),d>0&&(0,r.jsx)("button",{onClick:()=>c(Math.max(0,d-1)),className:"px-3 py-1 text-xs rounded font-semibold bg-red-500 text-white hover:bg-red-600",children:"[X]"}),(0,r.jsx)("button",{onClick:()=>c(d+1),className:"px-3 py-1 text-xs rounded font-semibold bg-blue-500 text-white hover:bg-blue-600",children:"+ Add Kpt"})]})]}),(0,r.jsx)("div",{ref:x,className:"tool-container relative border border-dashed p-4 rounded h-[90%] bg-gray-100/80",onMouseDown:e=>{if(!t||!m.current||"draw_box"!==v||0!==e.button||!N)return;let{x:a,y:r}=I(e.clientX,e.clientY);b({x:a,y:r}),y({x:a,y:r,w:0,h:0,realX:0,realY:0,realW:0,realH:0})},onMouseMove:e=>{if(!h||!t||!g)return;let{x:a,y:r}=I(e.clientX,e.clientY),l=Math.abs(a-h.x),n=Math.abs(r-h.y),s=Math.min(h.x,a),o=Math.min(h.y,r),i=f.naturalW/f.displayW,d=f.naturalH/f.displayH;y({...g,x:s,y:o,w:l,h:n,realX:Math.round(s*i),realY:Math.round(o*d),realW:Math.round(l*i),realH:Math.round(n*d)})},onMouseUp:E,onMouseLeave:E,onContextMenu:e=>{if(e.preventDefault(),!t||"add_keypoints"!==v||!M)return;let r=a.find(e=>e.id===M);if(!r)return;let{x:l,y:s}=I(e.clientX,e.clientY),o=f.naturalW/f.displayW,i=f.naturalH/f.displayH,c=Math.round(l*o),u=Math.round(s*i),x=r.box;if(c>=x.x&&c<=x.x+x.w&&u>=x.y&&u<=x.y+x.h){let e=[...r.keypoints];e[C]={x:c,y:u},n(a.map(t=>t.id===M?{...t,keypoints:e}:t)),C<d-1?_(C+1):(H("draw_box"),S(null),_(0))}else alert("Keypoint must be inside the bounding box. Please try again.")},children:t?N?(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"mt-2 text-black text-sm text-center truncate flex",children:[t.name,(0,r.jsx)("span",{className:"absolute top-1 left-4 bg-red-800 text-white text-xs px-2 py-0.5",children:"w:".concat(f.naturalW," h:").concat(f.naturalH)})]}),(0,r.jsxs)("div",{ref:m,className:"relative border w-fit min-w-[80vh] border-gray-300",style:{cursor:"add_keypoints"===v?"pointer":"crosshair"},children:[(0,r.jsx)("img",{ref:p,src:W||"",alt:t.name,onLoad:L,className:"w-full min-h-[100%] max-h-[100%] object-contain rounded pointer-events-none"}),R.map((e,t)=>{let a=o.find(t=>t.id===e.classId)||o[0];if(!a)return null;let l=e.id===M;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"absolute border-2 ".concat(a.color," ").concat(a.bg," ").concat(l?"animate-pulse ring-4 ring-blue-400/50":""),style:{left:e.displayBox.x,top:e.displayBox.y,width:e.displayBox.w,height:e.displayBox.h},children:(0,r.jsxs)("span",{className:"absolute top-0 left-0 ".concat(a.color.replace("border","text")," text-[8px] font-bold px-1 whitespace-nowrap text-white bg-red-600/60 backdrop-blur-sm"),children:["[",t+1,"] ",e.className," ",l?"▶ Kpt ".concat(C+1):""]})}),e.displayKeypoints.map((e,t)=>e&&(0,r.jsx)("div",{className:"absolute w-4 h-4 rounded-full ".concat(a.bg.replace("/20","/80")," ").concat(a.color," border-2 flex items-center justify-center"),style:{left:e.x-8,top:e.y-8},children:(0,r.jsx)("span",{className:"text-xs font-bold",style:{color:a.color.replace("border","text")},children:t+1})},t))]},e.id)}),g&&(0,r.jsx)("div",{className:"absolute border-2 ".concat(N.color," ").concat(N.bg),style:{left:g.x,top:g.y,width:g.w,height:g.h},children:(0,r.jsxs)("span",{className:"absolute top-0 left-0 bg-black/70 text-white text-xs px-1",children:["w:",g.realW,", h:",g.realH]})})]})]}):(0,r.jsx)("div",{className:"p-4 border border-dashed font-bold w-[100%] text-red-500 text-center",children:"Please add at least one class to start labeling."}):(0,r.jsx)("div",{className:"p-4 border border-dashed font-bold w-[100%] text-gray-500 text-center",children:"no image selected"})}),"add_keypoints"===v&&(0,r.jsxs)("div",{className:"p-2 text-center bg-blue-100 text-blue-800 rounded border border-blue-300 font-medium",children:["Right-click INSIDE box ",(0,r.jsxs)("strong",{children:[null==M?void 0:M.substring(0,6),"..."]})," to assign keypoint ",(0,r.jsxs)("strong",{children:[C+1,"/",d]}),". (Press Space to skip)"]})]})}let x=[{id:0,name:"car",color:"border-red-500",bg:"bg-red-500/20"},{id:1,name:"bus",color:"border-blue-500",bg:"bg-blue-500/20"},{id:2,name:"truck",color:"border-green-500",bg:"bg-green-500/20"},{id:3,name:"motorcycle",color:"border-yellow-500",bg:"bg-yellow-500/20"}];function m(){let[e,t]=(0,l.useState)(250),[a,n]=(0,l.useState)(500),[o,m]=(0,l.useState)(!1),p=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=e=>{if(o&&p.current){let t=p.current.getBoundingClientRect().right-e.clientX;t>250&&t<800&&n(t)}},t=()=>m(!1);return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),window.addEventListener("mouseleave",t),window.addEventListener("blur",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t),window.removeEventListener("mouseleave",t),window.removeEventListener("blur",t)}},[o]);let[h,b]=(0,l.useState)(null),[g,y]=(0,l.useState)([]),[f,w]=(0,l.useState)({naturalW:1,naturalH:1}),[v,j]=(0,l.useState)(new Map),[N,k]=(0,l.useState)(x),[M,S]=(0,l.useState)(0),[C,_]=(0,l.useState)(!1),W=(0,l.useRef)("draw_box"),H=v.get((null==h?void 0:h.name)||"")||[],I=e=>{if(!h)return;let t=new Map(v);t.set(h.name,e),j(t)},E=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=e=>{var t,a;"add_keypoints"!==W.current&&("Space"!==e.code||e.ctrlKey||(e.preventDefault(),null==(t=E.current)||t.nextImage()),"Space"===e.code&&e.ctrlKey&&(e.preventDefault(),null==(a=E.current)||a.prevImage()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,r.jsxs)("div",{ref:p,className:"".concat(s().className," ").concat(i().className," font-sans flex h-screen bg-gray-100"),children:[(0,r.jsxs)("div",{style:{width:e},className:"bg-gray-200 transition-all duration-300 flex flex-col shadow-lg",children:[(0,r.jsx)("button",{onClick:()=>t(100===e?300:100),className:"p-2 bg-gray-600 text-white font-bold hover:bg-gray-700",children:100===e?">>":"<<"}),e>0&&(0,r.jsx)("div",{className:"p-2 flex-1",children:(0,r.jsx)(d,{ref:E,onFileSelect:b,onFilesChange:y,isWidthCollapsed:100===e})})]}),(0,r.jsxs)("div",{className:"flex-1 bg-white p-2 flex flex-col gap-2",children:[(0,r.jsx)(u,{file:h,annotations:H,onAnnotationsChange:I,onImageLoad:e=>{e.naturalW>1&&e.naturalH>1&&w({naturalW:e.naturalW,naturalH:e.naturalH})},classes:N,onClassesChange:e=>{k(e)},keypointCount:M,onKeypointCountChange:e=>{e!==M&&(S(e),j(new Map),e>M&&e>0&&(_(!0),setTimeout(()=>_(!1),2e3)))},onModeChange:e=>{W.current=e}}),(0,r.jsx)("div",{className:"mt-2 p-3 border border-gray-300 rounded bg-gray-50 text-sm text-gray-700 shadow-sm",children:(0,r.jsxs)("div",{className:"flex flex-col items-start gap-2",children:[(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 text-gray-800 rounded font-mono text-xs",children:"Space"}),": Next Image"]}),(0,r.jsxs)("span",{className:"flex items-center gap-2 rounded py-1 pr-2 transition-all duration-100 ".concat(C?"flash-yellow":"bg-transparent"),children:[(0,r.jsx)("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 text-gray-800 rounded font-mono text-xs",children:"Space (add kpt)"}),": Skip current Keypoint"]}),(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 text-gray-800 rounded font-mono text-xs",children:"Ctrl + Space"}),": Previous Image"]}),(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 text-gray-800 rounded font-mono text-xs",children:"Left-click Drag"}),": Draw Bounding Box"]}),(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 text-gray-800 rounded font-mono text-xs",children:"Right-click"}),": Assign Keypoint(s) (after drawing box)"]}),(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)("kbd",{className:"px-2 py-1 bg-gray-200 border border-gray-300 text-gray-800 rounded font-mono text-xs",children:"Right-click [classID]"}),": Delete class"]})]})})]}),(0,r.jsxs)("div",{style:{width:a},className:"relative bg-gray-200 shadow-inner",children:[(0,r.jsx)("div",{className:"p-2",children:(0,r.jsx)(c,{imageName:(null==h?void 0:h.name)||"",imageSize:f,annotations:H,onAnnotationsChange:I,classes:N,allImageFiles:g,onBulkAnnotationsUpdate:e=>{j(new Map([...v,...e]))},keypointCount:M})}),(0,r.jsx)("div",{onMouseDown:()=>m(!0),className:"absolute left-0 top-0 h-full w-1.5 cursor-col-resize bg-transparent hover:bg-blue-400 transition-colors duration-200"})]})]})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=6760)),_N_E=e.O()}]);